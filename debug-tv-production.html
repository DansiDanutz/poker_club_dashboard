<!DOCTYPE html>
<html>
<head>
    <title>Debug Production TV Display</title>
</head>
<body>
    <h1>Debug Production TV Display</h1>
    <div id="log"></div>

    <script>
        const log = (msg) => {
            document.getElementById('log').innerHTML += `<p>${msg}</p>`;
        };

        async function debug() {
            try {
                log('üîç Fetching from production API...');
                const response = await fetch('https://hammerhead-app-f4ysx.ondigitalocean.app/api/tv-data');

                log(`üìä Response status: ${response.status}`);

                if (!response.ok) {
                    log(`‚ùå API failed: ${response.status}`);
                    return;
                }

                const data = await response.json();

                log(`‚úÖ Data received`);
                log(`üë• Players: ${data.players?.length || 0}`);
                log(`üéØ Promotions: ${data.promotions?.length || 0}`);
                log(`üìÖ Sessions: ${data.sessions?.length || 0}`);

                // Process exactly like TV display
                const players = data.players || [];
                const playerStats = {};
                let added = 0;

                players.forEach(player => {
                    // ADD ALL PLAYERS - NO FILTERING
                    const totalMinutes = (player.total_hours || 0) * 60;

                    playerStats[player.id] = {
                        id: player.id,
                        name: player.name || 'Unknown Player',
                        totalMinutes: totalMinutes,
                        sessions: player.total_sessions || 0
                    };
                    added++;
                });

                log(`üîÑ Processed ${added} players`);
                log(`üìã PlayerStats has ${Object.keys(playerStats).length} entries`);

                // Get sorted players
                const sorted = Object.values(playerStats)
                    .sort((a, b) => b.totalMinutes - a.totalMinutes);

                log(`üèÜ Top 5 players:`);
                sorted.slice(0, 5).forEach((player, i) => {
                    const hours = Math.floor(player.totalMinutes / 60);
                    const minutes = Math.floor(player.totalMinutes % 60);
                    log(`${i + 1}. ${player.name}: ${hours}h ${minutes}m`);
                });

                // Check what would be displayed
                if (sorted.length === 0) {
                    log('‚ö†Ô∏è No players to display - would show "Awaiting Players"');
                } else {
                    log(`‚úÖ Would display ${sorted.length} players`);
                }

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }

        debug();
    </script>
</body>
</html>